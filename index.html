<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Donkey Kong Web</title>
    <script src="https://cjrtnc.leaningtech.com/3.0/loader.js"></script>
    <style>
        body { margin: 0; background: #000; color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; }
        #game-container { border: 2px solid #333; background: #111; }
        #status { margin-bottom: 20px; font-size: 18px; color: #ffcc00; }
    </style>
</head>
<body>
    <div id="status">A aguardar pelo motor CheerpJ...</div>
    <div id="game-container"></div>

    <script>
        async function initialize() {
            const status = document.getElementById('status');
            
            // 1. Verifica se o script do motor foi carregado pelo browser
            if (typeof cheerpjInit === "undefined") {
                status.innerText = "Erro: O ficheiro loader.js não foi carregado. Verifica a tua ligação ou AdBlock.";
                status.style.color = "red";
                return;
            }

            try {
                status.innerText = "Motor detetado. A inicializar Java...";
                await cheerpjInit();
                
                status.innerText = "A carregar HongKong.jar (isto pode demorar)...";
                cheerpjCreateDisplay(800, 600, document.getElementById("game-container"));
                
                // O caminho /app/ é essencial para o Cloudflare Pages encontrar o JAR
                await cheerpjRunJar("/app/HongKong.jar");
                
                status.innerText = "Jogo pronto!";
            } catch (err) {
                status.innerText = "Erro ao iniciar o jogo. Vê a consola (F12).";
                console.error(err);
            }
        }

        // Executa apenas quando a página e os scripts estiverem 100% carregados
        window.addEventListener('load', initialize);
    </script>
</body>
</html>
